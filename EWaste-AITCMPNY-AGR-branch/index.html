<!DOCTYPE html>
<html>

<head>
  <link href="https://fonts.googleapis.com/css?family=Istok+Web&display=swap" rel="stylesheet" />
  <link href="./css/main.css" rel="stylesheet" />
  <title>AITCMPNY</title>
  <link rel="stylesheet" type="text/css" href="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.18.0/maps/maps.css" />
  <link rel="shortcut icon" href="#">
  <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.18.0/maps/maps-web.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
  <script>
    const redMarker = new tt.Marker({ color: 'red' }); // Create a red marker
  </script>
</head>

<body>
  <div class="v1_2">
    <div class="v1_3"></div>
    <div class="v1_4"><span class="v1_5">About Us</span><span class="v1_6">Credits</span><span
        class="v1_7">Locate</span><span class="v1_8">Home</span></div>
    <div class="v1_9">
      <div class="v1_10"></div><span class="v1_11">AITCMPNY</span>
      <div class="v1_12"></div>
    </div>
    <div class="name"></div><span class="v1_14">Locate</span>
    <div class="name"></div>
    <div class="name"></div>
    <div class="name"></div>
    <div class="v1_18"></div>
    <div class="v1_19">
      <div id="map" style="width: 900px; height: 600px;"></div>


      <script type="text/javascript">
        var map = tt.map({
          key: "gdDQALLPzOIVyP5gTdrqyBkXJCPfhRu4",
          container: "map",
          center: center,
          zoom: 10
        })

        // Check if geolocation is available in the browser
        if ("geolocation" in navigator) {
          navigator.geolocation.getCurrentPosition(function (position) {
            var userLat = position.coords.latitude;
            var userLng = position.coords.longitude;

            map.setCenter([userLng, userLat]);

            // Add a marker at the user's location
            redMarker
              .setLngLat([userLng, userLat])
              .setPopup(new tt.Popup().setHTML(`<p>Latitude: ${userLat}<br>Longitude: ${userLng}</p>`))
              .addTo(map);
          });
        } else {
          alert("Enable location permission!!!");
          console.error("Geolocation is not available in this browser.");
        }

        // Function to add markers for all locations in the Excel file
        function addMarkersForLocations(data) {
          data.forEach((location) => {
            new tt.Marker()
              .setLngLat([location.longitude, location.latitude])
              .setPopup(new tt.Popup().setHTML(`<p><h4>${location.name}</h4>${location.email}<br>${location.contact}</p></p>`))
              .addTo(map);
          });
        }

        // Fetch and parse the Excel file
        fetch('location.xlsx')
          .then((response) => response.arrayBuffer())
          .then((arrayBuffer) => {
            const data = new Uint8Array(arrayBuffer);
            const workbook = XLSX.read(data, { type: 'array' });
            const sheetName = workbook.SheetNames[0];
            const sheet = workbook.Sheets[sheetName];
            const jsonData = XLSX.utils.sheet_to_json(sheet);
            addMarkersForLocations(jsonData);
          })
          .catch((error) => {
            console.error('Error fetching or parsing Excel file:', error);
          });
      </script>
    </div>
    <span class="v1_20">Credits</span>
    <div class="v1_27"></div>
    <div class="v1_45"></div>
    <div class="v1_28">
      <div class="v1_29"></div>
    </div>
    <div class="v1_33"></div>
    <div class="v1_30"></div>
    <div class="v1_35">
      <div class="v1_36">
        <form id="location-form">
          <input type="text" id="location-input" placeholder="Enter a location"
            style="position: relative;top: 4px;left: 14px;width: 373px;">
          <img src=".\images\search.png" onclick="submitForm()" style="position: relative; left: 20px; top: 15px;">
        </form>

        <script>

          function submitForm() {
            const location = locationInput.value;

            // Create the API request URL
            const apiUrl = `https://api.tomtom.com/search/2/geocode/${encodeURIComponent(location)}.json?key=${apiKey}`;

            // Make a GET request to TomTom API
            axios.get(apiUrl)
              .then(response => {
                const coordinates = response.data.results[0].position;
                const lat = coordinates.lat;
                const lng = coordinates.lon;

                console.log(`Latitude: ${lat}`);
                console.log(`Longitude: ${lng}`);

                // Update the map center to the user-entered coordinates
                map.setCenter([lng, lat]);

                // Add a marker at the user-entered location
                redMarker
                  .setLngLat([lng, lat])
                  .setPopup(new tt.Popup().setHTML(`<p>Latitude: ${lat}<br>Longitude: ${lng}</p>`))
                  .addTo(map);
              })
              .catch(error => {
                console.error('Error fetching data:', error);
              });
          }

          const locationInput = document.getElementById('location-input');
          let center = [4, 44.4]; // Default map center

          // Replace 'YOUR_API_KEY' with your actual TomTom API Key
          const apiKey = 'gdDQALLPzOIVyP5gTdrqyBkXJCPfhRu4'; // Replace with your API key

          var map = tt.map({
            key: apiKey,
            container: "map",
            center: center,
            zoom: 10
          });

        </script>
        <script type="text/javascript">
          var map = tt.map({
            key: "gdDQALLPzOIVyP5gTdrqyBkXJCPfhRu4",
            container: "map",
            center: center,
            zoom: 10
          })

          // Check if geolocation is available in the browser
          if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(function (position) {
              var userLat = position.coords.latitude;
              var userLng = position.coords.longitude;

              map.setCenter([userLng, userLat]);

              // Add a marker at the user's location
              redMarker
                .setLngLat([userLng, userLat])
                .setPopup(new tt.Popup().setHTML(`<p>Latitude: ${userLat}<br>Longitude: ${userLng}</p>`))
                .addTo(map);
            });
          } else {
            alert("Enable location permission!!!");
            console.error("Geolocation is not available in this browser.");
          }

          // Function to add markers for all locations in the Excel file
          function addMarkersForLocations(data) {
            data.forEach((location) => {
              new tt.Marker()
                .setLngLat([location.longitude, location.latitude])
                .setPopup(new tt.Popup().setHTML(`<p><h4>${location.name}</h4>${location.email}<br>${location.contact}</p></p>`))
                .addTo(map);
            });
          }

          // Fetch and parse the Excel file
          fetch('location.xlsx')
            .then((response) => response.arrayBuffer())
            .then((arrayBuffer) => {
              const data = new Uint8Array(arrayBuffer);
              const workbook = XLSX.read(data, { type: 'array' });
              const sheetName = workbook.SheetNames[0];
              const sheet = workbook.Sheets[sheetName];
              const jsonData = XLSX.utils.sheet_to_json(sheet);
              addMarkersForLocations(jsonData);
            })
            .catch((error) => {
              console.error('Error fetching or parsing Excel file:', error);
            });
        </script>
      </div>
      <!-- <div class="v1_37">
        <button id="submit" type="submit" onclick="locate_e_waste_facility()">
          <img src="images/search.png">
        </button>

      </div> -->
    </div>
    <div class="v1_38">
      <div class="v1_39"></div>
      <div class="v1_40"></div>
    </div>
    <div class="v1_41"></div>
    <div class="v1_42"></div>
    <div class="v5_11">
      <div class="v5_10"></div>
      <div class="v5_6"></div>
      <div class="v5_8"></div>
    </div><span class="v1_43">About Us</span><span class="v5_2">Address

    </span><span class="v5_12">Location</span>
    <span class="v5_14">Phone</span>
    <span class="v5_15">Mail</span>
    <span class="v5_3">Info<br>

      Enhances e-waste management, by locating nearby e-waste facility locations of the entered city.
      Also credits the user to deposit the e-waste according to precious metals used in producttype.</span><span
      class="v5_4">Developers<br>
      <ul>
        <li>Chaitali Gaikwad</li>
        <li>Kapil Bodas</li>
        <li>Aryan Raje</li>
        <li>Kanak Pendse</li>
        <li>M Kaif</li>
        <li>Ishita Marathe</li>
      </ul>
    </span><span class="v1_44">Articles</span>
  </div>
</body>

</html>